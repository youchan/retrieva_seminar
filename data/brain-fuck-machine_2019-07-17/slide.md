# Brainf\*ck machine

%subtitle: ã€œä½œã£ã¦ã‚ã‹ã‚‹CPUã®ã—ãã¿(ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ç·¨)ã€œ

%author: Retrieva Engineer Casual Talk vol.2 å¤§å´Ž ç‘¶

![icon](youchan.jpg)

## whoami

* åå‰
  - å¤§å´Ž ç‘¶(ã‚ˆã†)
* ç•¥æ­´
  - 1990 - 1997 æ±äº¬é›»æ©Ÿå¤§å­¦ å·¥å­¦éƒ¨ é›»å­å·¥å­¦ç§‘
  - 1998 - 2000 ç­‘æ³¢å¤§å­¦ å¤§å­¦é™¢ é›»å­æƒ…å ±å·¥å­¦ç ”ç©¶ç§‘ (å·¥å­¦ä¿®å£«äº†)
  - 2009 - 2014 æ ªå¼ä¼šç¤¾ã‚¢ãƒ—ãƒ¬ãƒƒã‚½
  - 2014 - 2017 æ ªå¼ä¼šç¤¾ãƒ¦ãƒ“ãƒ¬ã‚¸
  - 2017/11 æ ªå¼ä¼šç¤¾ãƒ¬ãƒˆãƒªãƒ å…¥ç¤¾
* è¶£å‘³
  - ãŠé…’ ðŸ¶
  - ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°
    - æŠ€è¡“æ›¸ã®è–„ã„æœ¬
  - é›»å­å·¥ä½œ

![analog](analog.jpg)

## Brainf\*ck

* é›£è§£ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªžã®ä¸€ç¨®
* 8ã¤ã®å‘½ä»¤ã ã‘ã‹ã‚‰æˆã‚‹
* å°‘ãªãã¨ã‚‚30000å€‹ã®è¦ç´ ã‚’æŒã¤ãƒã‚¤ãƒˆã®é…åˆ—
* ãƒãƒ¥ãƒ¼ãƒªãƒ³ã‚°å®Œå…¨

â€» BFè¨€èªžã¾ãŸã¯å˜ã«BFã¨å‘¼ã¶ã“ã¨ã«ã—ã¾ã™ã€‚

## Brainf\*ckã®å‘½ä»¤

| å‘½ä»¤ | å‹•ä½œ               |
|------|--------------------|
| >    | `ptr++;`           |
| <    | `ptr--;`           |
| +    | `(*ptr)++`         |
| -    | `(*ptr)--`         |
| .    | `putchar(*ptr)`    |
| ,    | `*ptr = getchar()` |
| [    | `while (*ptr) {`   |
| ]    | `}`                |


## CPUã®å‰µã‚Šã‹ãŸ

![portlait-left](cpu.jpeg)

%right:

* TTLãƒ­ã‚¸ãƒƒã‚¯ICã§CPUã‚’ã¤ãã‚‹
* 4bit CPU: TD4
* ãƒ©ãƒ¼ãƒ¡ãƒ³ã‚¿ã‚¤ãƒžãƒ¼ãŒã¤ãã‚Œã‚‹!

## Brainf\*ck machine

* ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–ãªå‘½ä»¤(CPUå‘½ä»¤ãã‚‰ã„ã®ãƒ¬ãƒ™ãƒ«)ã—ã‹ãªã„
* 8å‘½ä»¤ã—ã‹ãªã„
* TD4ã®å·¥ä½œã®é›£ã—ã•ã‚’è§£æ¶ˆã™ã‚‹ã‚¢ã‚¤ãƒ‡ã‚¢ãŒã‚ã‚‹

---

%large: åŒæ§˜ã®æ‰‹æ³•ã§Brainf\*ck machineã¤ãã‚Œã‚‹ã‚“ã˜ã‚ƒãªã„ã®ï¼Ÿ

## TD4ã®å·¥ä½œã®é›£ã—ã•ã‚’è§£æ¶ˆ

![portlait-right](TD4CPU.JPG)

%left:

* ãƒ¡ãƒ¢ãƒªã‚’ãƒžã‚¤ã‚³ãƒ³ã§ä»£ç”¨
* ãƒ–ãƒ¬ãƒƒãƒ‰ãƒœãƒ¼ãƒ‰ã§å®Ÿè£…

â€»  ã€å†™çœŸã€‘:å¼Šç¤¾ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å²©ç”°ã•ã‚“æä¾›

## ä»•æ§˜

|            | BF-Machine                     | TD4     |
|------------|--------------------------------|---------|
|            | 8bit                           | 4bit    |
| ãƒ¬ã‚¸ã‚¹ã‚¿æ•° | 5                              | 4       |
| å‘½ä»¤æ•°     | 11(å†…éƒ¨å‘½ä»¤)                   | 12      |
| ãƒ¡ãƒ¢ãƒª     | å‘½ä»¤ã€ãƒ‡ãƒ¼ã‚¿ã€ã‚¸ãƒ£ãƒ³ãƒ—ãƒ†ãƒ¼ãƒ–ãƒ« | å‘½ä»¤ROM |

## ãƒ–ãƒ­ãƒƒã‚¯ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ 

![large](block-diagram.png)


## ãƒ¡ãƒ¢ãƒªã®å®Ÿè£…

* TD4ã§ã¯ROMã‚’ãƒ‡ã‚£ãƒƒãƒ—ã‚¹ã‚¤ãƒƒãƒã§å®Ÿç¾
* BF machineã§ã¯R/Wå‡ºæ¥ã‚‹ãƒ¡ãƒ¢ãƒªãŒå¿…è¦
* Arduinoã§ãƒ¡ãƒ¢ãƒªã‚’ä»£ç”¨

## å‘½ä»¤ãƒ•ã‚§ãƒƒãƒ

---

%large: å„å‘½ä»¤ã®å®Ÿè£…

## `<` `>`

1. ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ã‚¿ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ

## ã‚¢ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã‚«ã‚¦ãƒ³ã‚¿

* 74HC191
* TD4ã§ã¯74HC161ã¨ã„ã†ã‚¢ãƒƒãƒ—ã‚«ã‚¦ãƒ³ã‚¿ã‚’ä½¿ã£ã¦ã„ã‚‹

## `+` `-`

1. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
2. ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã€ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
3. ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒˆã‚¢

---

%large: å†…éƒ¨å‘½ä»¤

---


| ãƒ‹ãƒ¼ãƒ¢ãƒ‹ãƒƒã‚¯ | å‹•ä½œ                           | ã‚³ãƒ¼ãƒ‰   |
|--------------|--------------------------------|----------|
| LD           | ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰                 | `00000011` |
| ST           | ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒˆã‚¢                 | `00000001` |
| INC          | ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ         | `00010000` |
| DEC          | ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ           | `00100000` |
| FW           | ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ã‚¿ã‚’ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ | `00000100` |
| BW           | ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ã‚¿ã‚’ãƒ‡ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ   | `00001000` |
| LDJT         | ã‚¸ãƒ£ãƒ³ãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰(*)    | `00000010` |
| STJT         | ã‚¸ãƒ£ãƒ³ãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã‚¹ãƒˆã‚¢(*)    | `00110000` |
| JPZ          | ãƒ‡ãƒ¼ã‚¿ãŒ0ãªã‚‰ã‚¸ãƒ£ãƒ³ãƒ—          | `00001100` |
| OUT          | ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›                   | `01000000` |
| IN           | å…¥åŠ›ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã«ã‚¹ãƒˆã‚¢         | `10000000` |

---

%large: å‘½ä»¤å¤‰æ›ãƒ†ãƒ¼ãƒ–ãƒ«

---

| ã‚¢ãƒ‰ãƒ¬ã‚¹ | ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ | å†…éƒ¨å‘½ä»¤ |
|----------|--------------------|----------|
| 0x01     | >                  | FW       |
| 0x02     | <                  | BW       |
| 0x03     | +                  | LD       |
| 0x04     |                    | INC      |
| 0x05     |                    | ST       |
| 0x06     | -                  | LD       |
| 0x07     |                    | DEC      |
| 0x08     |                    | ST       |
| 0x09     | .                  | OUT      |
| 0x0a     | ,                  | IN       |
| 0x0b     | [                  | LDJT     |
| 0x0c     |                    | JPZ      |
| 0x0d     | ]                  | LDJT     |
| 0x0e     |                    | JPZ      |

---

![middle](in-inst-table.png)

---

%large: ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼

## Brainf\*ckã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³

| ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³ | å†…éƒ¨å‘½ä»¤  | ã‚³ãƒ¼ãƒ‰ |
|--------------------|-----------|--------|
| >                  | FW        | 0x11   |
| <                  | BW        | 0x12   |
| +                  | LD,INC,ST | 0x33   |
| -                  | LD,DEC,ST | 0x36   |
| .                  | OUT       | 0x2a   |
| ,                  | IN        | 0x1b   |
| [                  | LD,JPZ    | 0x2c   |
| ]                  | LD,JPZ    | 0x2e   |

---

![large](decoder.png)

## `.` `,`

* ãƒ‡ãƒ¼ã‚¿ã‚’å‡ºåŠ›ãƒãƒ¼ãƒˆã«å‡ºåŠ›
* å…¥åŠ›ãƒãƒ¼ãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¹ãƒˆã‚¢
  * å…¥åŠ›å¾…ã¡ãŒç™ºç”Ÿã™ã‚‹ã®ã§ç©ºå›žã‚Šã•ã›ã‚‹

## `[` `]`

1. ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ãƒ‰
2. ãƒ‡ãƒ¼ã‚¿ãŒ0ãªã‚‰ã°ã‚¸ãƒ£ãƒ³ãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚«ã‚¦ãƒ³ã‚¿ã¸ãƒ­ãƒ¼ãƒ‰

## ã‚¸ãƒ£ãƒ³ãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«

* `[`,`]`ã®å¯¾å¿œä»˜ã‘ã‚’ã™ã‚‹ãŸã‚ã«ã‚ã‚‰ã‹ã˜ã‚ä½œã£ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã€‚
* ã‚¹ã‚¿ãƒƒã‚¯ã‚’ä½œã£ã¦ãŠã„ã¦èµ·å‹•å¾Œã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä¸€å‘¨èª­ã‚“ã§ã‚¸ãƒ£ãƒ³ãƒ—ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ã¤ãã‚‹

---

%huge: è¨€ã„è¨³

## ä½•æ•…ï¼Ÿå®Œæˆã—ãªã‹ã£ãŸã‹ï¼Ÿ

ã‚ã‚‹ã„ã¯ã€TD4ã«æ¯”ã¹ã¦ã©ã“ãŒã‚€ãšã‹ã—ã„ã®ã‹

* å†…éƒ¨å‘½ä»¤ãƒ†ãƒ¼ãƒ–ãƒ«ãŒå¿…è¦ã¨ã„ã†ã“ã¨
* ãƒ¡ãƒ¢ãƒªã®ãƒªãƒ¼ãƒ‰/ãƒ©ã‚¤ãƒˆãŒå¿…è¦
  * TD4ã¯åˆ¶å¾¡æ–¹å‘ãŒä¸€æ–¹å‘
  * BF machineã¯ãƒ•ã‚§ãƒƒãƒãƒ•ã‚§ãƒ¼ã‚ºã¨å‘½ä»¤å®Ÿè¡Œãƒ•ã‚§ãƒ¼ã‚ºãŒã‚ã‚‹
* ãƒžã‚¤ã‚³ãƒ³ã‚’æŒŸã‚“ã ãŸã‚ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå¾®å¦™ãªã¨ã“ã‚ãŒã‚ã‚‹

## ã“ã®å…ˆã‚„ã‚ŠãŸã„ã“ã¨

* å®Œæˆã•ã›ã‚‹
* å…¥å‡ºåŠ›
* ãƒ—ãƒªãƒ³ãƒˆåŸºç›¤ã¨ã‚­ãƒƒãƒˆåŒ–
* ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒã‚¹ã®16bitåŒ–
  * 30000ä»¥ä¸Šã®ãƒ‡ãƒ¼ã‚¿é…åˆ—ã‚µã‚¤ã‚º(2^16=65536)
* ãƒ¡ãƒ¢ãƒªã‚’å®Ÿãƒ¡ãƒ¢ãƒªã§å®Ÿè£…
  * ãƒ¡ãƒ¢ãƒªã®å–ã‚Šæ‰±ã„ã¯é›£ã—ã„ï¼žï¼œ

## ã¾ã¨ã‚

* TD4ã‚’å‚è€ƒã«Brainf\*ck machineã®è¨­è¨ˆã‚’ã—ã¾ã—ãŸã€‚
* ã¾ã ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼éƒ¨ã—ã‹å‹•ã„ã¦ã„ã¾ã›ã‚“ã€‚
* å®Œæˆã—ãŸã‚‰ã¾ãŸã©ã“ã‹ã§ç™ºè¡¨ã—ãŸã„ã§ã™ã€‚

---

%large: ãƒ–ãƒ­ã‚°æ›¸ãã¾ã™ã€‚([Retrieva TECH BLOG](https://tech.retrieva.jp/))

---

---
